# 어려웠던 문제들 다시 풀어보기!

## 조건에 맞는 사원 정보 조회하기[https://school.programmers.co.kr/learn/courses/30/lessons/284527]

```SQL
SELECT G.SCORE, E.EMP_NO, E.EMP_NAME, E.POSITION, E.EMAIL
FROM HR_EMPLOYEES E
JOIN (
    SELECT EMP_NO, SUM(SCORE) AS SCORE
    FROM HR_GRADE
    WHERE YEAR = '2022'
    GROUP BY EMP_NO
    ORDER BY SCORE DESC
    LIMIT 1
) G ON E.EMP_NO = G.EMP_NO
```

> max를 쓰거나 desc limit 1을 쓰면 되는건데, 쿼리 순서를 잘 고려했을 때만 정답을 맞출 수 있는 문제!


## 조회수가 가장 많은 중고거래 게시판의 첨부파일 조회하기[https://school.programmers.co.kr/learn/courses/30/lessons/164671]

```SQL
SELECT CONCAT('/home/grep/src/', B.BOARD_ID, '/', F.FILE_ID, F.FILE_NAME, F.FILE_EXT) AS "FILE_PATH"
FROM USED_GOODS_BOARD B
JOIN USED_GOODS_FILE F ON B.BOARD_ID = F.BOARD_ID
WHERE B.VIEWS = (
    SELECT MAX(VIEWS)
    FROM USED_GOODS_BOARD)
ORDER BY F.FILE_ID DESC;
```


## 특정 조건을 만족하는 물고기별 수와 최대 길이 구하기[https://school.programmers.co.kr/learn/courses/30/lessons/298519]

### 처음 쓴 코드
```SQL
SELECT 
    COUNT(*) AS "FISH_COUNT",
    MAX(COALESCE(LENGTH, 10)) AS "MAX_LENGTH",
    FISH_TYPE
FROM FISH_INFO
WHERE AVG(COALESCE(LENGTH)) >= 33
GROUP BY FISH_TYPE
ORDER BY FISH_TYPE ASC;
```
> WHERE절에서 집계함수 못 쓰는거 잊지 말기~..



## 업그레이드 할 수 없는 아이템 구하기(https://school.programmers.co.kr/learn/courses/30/lessons/273712)
```SQL
SELECT
    I.ITEM_ID,
    I.ITEM_NAME,
    I.RARITY
FROM ITEM_INFO I
LEFT JOIN ITEM_TREE T
ON I.ITEM_ID = T.PARENT_ITEM_ID
WHERE T.PARENT_ITEM_ID IS NULL
ORDER BY I.ITEM_ID DESC;
```


> LEFT JOIN과 친해집시다
LEFT JOIN
- 왼쪽 테이블의 모든 데이터를 유지하면서, 오른쪽 테이블의 일치하는 데이터만 가져오는 조인 방식
- 만약 오른쪽 테이블에 일치하는 데이터가 없으면 NULL이 반환
- 사용하는 경우
    1.  기준 테이블(왼쪽 테이블)의 모든 데이터를 유지하면서 다른 정보를 추가하고 싶을 때
        EX. 고객 목록을 유지하면서 주문 정보를 가져오기
    2. 특정 조건을 만족하지 않는 데이터(연결되지 않은 데이터)를 찾을 때
        EX. 주문한 고객/하지 않은 고객이 섞여있는 데이터에서 주문하지 않은 고객 찾기 (WHERE o.order_id IS NULL)
    3. 데이터가 있을 수도 있고 없을 수도 있는 관계에서 기준 데이터를 유지할 때
        EX. 학생 목록을 유지하면서 가입한 동아리 정보를 가져오기